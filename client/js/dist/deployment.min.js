"use strict";var Game={};Game.Players={},Game.boundaries=[],Game.holes=[],Game.text={},Game.height=0,Game.init=function(){game.state.disableVisibilityChange=!1,setGameEventHandlers()},Game.create=function(){Game.add.sprite(0,0,"background"),Game.add.sprite(0,1152,"background"),game.world.setBounds(0,0,1900,1900),Client.askNewPlayer(),Game.cursor={x:450,y:300},Game.Player=game.add.group(),Game.bound=game.add.group(),Game.heartBeat(),Game.pulse=setInterval(Game.heartBeat,10)},Game.update=function(){Game.holes.length||Game.rawHoles&&Game.renderHoles(Game.rawHoles),Game.cursor={x:game.input.activePointer.worldX,y:game.input.activePointer.worldY},game.input.activePointer.isDown&&(Game.cursor={x:game.input.activePointer.worldX,y:game.input.activePointer.worldY})},Game.heartBeat=function(){Client.heartBeat(Game.cursor)},Game.updatePlayerPosition=function(a){var b=Game.Players[a.id],c=Game.text[a.username];if(console.log("move player"),b){var d=Game.add.tween(b);d.to({x:a.x,y:a.y},16),d.start();var e=Game.add.tween(c);e.to({x:a.x,y:a.y},16),e.start()}},Game.addNewPlayer=function(a){Game.displayPlayerInfo(a);var b=a.id;Game.Players[a.id]&&Game.Players[a.id].destroy(),Game.Players[a.id]=Game.Player.create(a.x,a.y,""+a.colorID);var a=Game.Players[a.id];a.anchor.x=.5,a.anchor.y=.5,console.log(b,loadState.username),b===loadState.username&&(console.log("in the right if statement"),game.physics.enable(a),game.camera.follow(a))},Game.remove=function(a){Game.Players[a].destroy(),delete Game.Players[a]},Game.death=function(a){a=Game.Players[a.id],a.kill()},Game.displayPlayerInfo=function(a){if(a.username){var b=a.username;Game.text[b]&&Game.text[b].destroy(),Game.text[b]=game.add.text(a.x,a.y,b,{font:"18px Arial",fill:"#000000"})}},Game.renderHoles=function(a){Game.hole=game.add.group(),a.forEach(function(a){Game.holes.push(Game.hole.create(a.x,a.y,"hole"))}),Game.holes.forEach(function(a){a.animations.add("explode"),a.anchor.y=.5,a.anchor.x=.5,a.animations.play("explode",50,!0)})},Game.over=function(a){game.state.start("Results",!0,!1,a),Client.disconnect(),Game.Players={},Game.boundaries=[],Game.holes=[],Game.text={}};var gameResult={init:function(a){console.log("params",a);var b=_.filter(a,function(a){return a.lives>0}),c=_.filter(a,function(a){return 0===a.lives}),d=b[0];console.log("winners",b[0]),console.log("losers",c),game.add.text(game.world.width/2,40,"Winner: Player "+d.id+" ",{font:"50px Arial",fill:"#000000"}).anchor.set(.5),console.log("game stage",game.stage),this.drawLosers(c),game.add.text(game.world.width/2,game.world.height-40,'Press the "p" key to return to the main menu',{font:"25px Arial",fill:"#000000"}).anchor.set(.5),game.input.keyboard.addKey(Phaser.Keyboard.P).onDown.addOnce(this.toLobby,this)},drawLosers:function(a){var b=80;_.forEach(a,function(a){var c={font:"bold 30pt italic"},d=game.add.text(80,b,"Loser",c);game.add.text(d.x+d.width+30,b,a.id,c);b+=150})},preload:function(){game.stage.backgroundColor=12245589},toLobby:function(){game.state.start("Lobby")}},loadState={preload:function(){game.add.text(80,150,"loading...",{font:"40px Courier",fill:"#ffffff"});game.physics.startSystem(Phaser.Physics.Arcade),game.load.image("background","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/board.png"),game.load.image("0","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/0.png"),game.load.image("1","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/1.png"),game.load.image("2","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/2.png"),game.load.image("3","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/3.png"),game.load.image("4","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/4.png"),game.load.image("5","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/5.png"),game.load.image("6","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/6.png"),game.load.image("7","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/7.png"),game.load.image("8","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/8.png"),game.load.image("9","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/9.png"),game.load.image("10","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/10.png"),game.load.image("11","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/11.png"),game.load.image("vertical","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/rectanglevertical.png"),game.load.image("horiontal","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/rectangle.png"),game.load.image("joinAsPlayerButton","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/playButton.jpg"),game.load.image("joinAsSpectatorButton","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/spectateButton.png"),game.load.spritesheet("hole","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/spritmap.png",256,256,38),game.load.spritesheet("playerNotReady","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/playerNotReady.png",138,138,4),game.load.image("playerReady","https://s3-us-west-1.amazonaws.com/pearljamhrsf72/playerReady.png")},create:function(){window.spectate&&game.state.start("Spectate")},update:function(){loadState.username=localStorage["reduxPersist:user"]?JSON.parse(localStorage["reduxPersist:user"]).displayName:prompt("What is your username?"),loadState.colorID=localStorage["reduxPersist:user"]?JSON.parse(localStorage["reduxPersist:user"]).avatar:Math.floor(11*Math.random()),loadState.username&&(console.log("game is starting"),game.state.start("Lobby"))}},lobbyState={playerNameHeight:30,isReady:!1,preload:function(){},create:function(){Client.socketConnect(),setLobbyEventHandlers(),Client.joinLobby(),game.state.backgroundColor="#333",game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.addOnce(this.ready,this)},update:function(){game.input.activePointer.isDown&&this.ready()},ready:function(){this.isReady||Client.ready(),this.isReady=!0},addStartLabels:function(){game.add.text(game.world.width/2,50,"Welcome to Game Server 1",{font:"35px Arial",fill:"#ffbfda"}).anchor.set(.5),game.add.text(game.world.width/2,game.world.height-50,"click when you are ready",{font:"35px Arial",fill:"#ffbfda"}).anchor.set(.5)},renderServerInfo:function(a){this.allReady(a)&&(removeAllSocketListeners(),game.state.start("Game")),game.world.children=[],this.addStartLabels();var b=80;_.forEach(a,function(a){var c={font:"bold 30pt italic",fill:"#f001f2"},d=game.add.text(80,b,a.id,c);if(a.ready){game.add.button(d.x+d.width,b,"playerReady")}else{var e=game.add.sprite(d.x+d.width,b,"playerNotReady");e.scale.set(.5),e.animations.add("toggle",[0,1,2,3],12,!0),e.play("toggle")}b+=75})},allReady:function(a){return a.reduce(function(a,b){return a&&b.ready},!0)}},winW=window.innerWidth,winH=window.innerHeight,game=new Phaser.Game(winW-50,winH-50,Phaser.CANVAS,document.getElementById("game"),null,!1);game.state.add("Load",loadState),game.state.add("Menu",menuState),game.state.add("Lobby",lobbyState),game.state.add("Game",Game),game.state.add("Spectate",spectateState),game.state.add("Results",gameResult),game.state.start("Load");var menuState={create:function(){Client.socketConnect();game.add.text(80,80,"Pearl Jam",{font:"50px Arial",fill:"#000000"}),game.add.button(0,200,"joinAsPlayerButton",menuState.joinAsPlayer,this,2,1,0),game.add.button(200,150,"joinAsSpectatorButton",menuState.joinAsSpectator,this,2,1,0)},joinAsPlayer:function(){game.state.start("Lobby")},joinAsSpectator:function(){game.state.start("Spectate")}},spectateState={};spectateState.Players={},spectateState.boundaries=[],spectateState.holes=[],spectateState.text={},spectateState.init=function(){Client.socketConnect(),spectateState.state.disableVisibilityChange=!0,setSpectateEventHandlers()},spectateState.create=function(){spectateState.add.sprite(0,0,"background"),spectateState.Player=game.add.group(),spectateState.bound=game.add.group(),spectateState.hole=game.add.group(),spectateState.holes.push(spectateState.hole.create(375,375,"hole")),spectateState.holes.forEach(function(a){a.animations.add("explode"),a.anchor.y=.5,a.anchor.x=.5,a.animations.play("explode",50,!0)}),spectateState.bound.create(750,0,"vertical"),Client.askNewSpectator()},spectateState.addNewPlayer=function(a){spectateState.Players[a.id]=spectateState.Player.create(a.x,a.y,"character");var a=spectateState.Players[a.id];a.anchor.x=.5,a.anchor.y=.5},spectateState.updatePlayerPosition=function(a){var b=spectateState.Players[a.id];if(b){var c=spectateState.add.tween(b);c.to({x:a.x,y:a.y},10),c.start()}spectateState.displayPlayerInfo(a)},spectateState.remove=function(a){spectateState.playerMap[a].destroy(),delete spectateState.playerMap[a]},spectateState.displayPlayerInfo=function(a){var b=a.username;spectateState.text[b]&&spectateState.text[b].destroy(),spectateState.text[b]=game.add.text(a.x,a.y,b,{font:"18px Arial",fill:"#000000"});var c=a.username+": "+a.lives+" lives",d=30+30*a.id,e=a.id;spectateState.text[e]&&spectateState.text[e].destroy(),spectateState.text[e]=game.add.text(760,d,c,{font:"18px Arial",fill:"#000000"})},spectateState.over=function(a){Client.disconnect(),game.state.start("Results",!0,!1,a),spectateState.Players={},spectateState.boundaries=[],spectateState.holes=[],spectateState.text={}},spectateState.death=function(a){a=spectateState.Players[a.id],a.kill()};